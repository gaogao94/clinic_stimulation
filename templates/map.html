<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¸Šæµ·åŒºåŸŸåœ°å›¾</title>
    <!-- å¼•å…¥é«˜å¾·åœ°å›¾API -->
    <script type="text/javascript">
        // åŠ¨æ€åŠ è½½é«˜å¾·åœ°å›¾API
        function loadAMapAPI() {
            return new Promise((resolve, reject) => {
                if (window.AMap) {
                    resolve(window.AMap);
                    return;
                }
                
                const script = document.createElement('script');
                script.type = 'text/javascript';
                script.src = 'https://webapi.amap.com/maps?v=2.0&key=131e12f30a06e794a3533d4c60d33326';
                script.onload = () => resolve(window.AMap);
                script.onerror = reject;
                document.head.appendChild(script);
            });
        }
    </script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
        }
        
        .container {
            display: flex;
            flex-direction: column;
            height: 100vh;
        }
        
        .header {
            background-color: #fff;
            padding: 1rem;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .header h1 {
            font-size: 1.5rem;
            color: #333;
        }
        
        .controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }
        
        .district-selector {
            display: flex;
            gap: 0.5rem;
            flex-wrap: wrap;
        }
        
        .district-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #fff;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .district-btn.active {
            background-color: #1890ff;
            color: white;
            border-color: #1890ff;
        }
        
        .layers-control {
            display: flex;
            gap: 1rem;
            align-items: center;
        }
        
        .layer-toggle {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            cursor: pointer;
        }
        
        .map-container {
            flex: 1;
            position: relative;
        }
        
        #map {
            width: 100%;
            height: 100%;
        }
        
        .info-panel {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background-color: white;
            padding: 1rem;
            border-radius: 4px;
            box-shadow: 0 2px 8px rgba(0,0,0,0.15);
            width: 250px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .info-panel h3 {
            margin-bottom: 1rem;
            font-size: 1.2rem;
            color: #333;
        }
        
        .poi-list {
            list-style: none;
        }
        
        .poi-item {
            padding: 0.5rem 0;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: background-color 0.2s ease;
        }
        
        .poi-item:hover {
            background-color: #f0f0f0;
        }
        
        .poi-item:last-child {
            border-bottom: none;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>ä¸Šæµ·åŒºåŸŸåœ°å›¾</h1>
            <div class="controls">
                <div class="district-selector">
                    <button class="district-btn active" data-district="é»„æµ¦åŒº">é»„æµ¦åŒº</button>
                    <button class="district-btn" data-district="å¾æ±‡åŒº">å¾æ±‡åŒº</button>
                    <button class="district-btn" data-district="é•¿å®åŒº">é•¿å®åŒº</button>
                    <button class="district-btn" data-district="é™å®‰åŒº">é™å®‰åŒº</button>
                    <button class="district-btn" data-district="æ™®é™€åŒº">æ™®é™€åŒº</button>
                    <button class="district-btn" data-district="è™¹å£åŒº">è™¹å£åŒº</button>
                    <button class="district-btn" data-district="æ¨æµ¦åŒº">æ¨æµ¦åŒº</button>
                    <button class="district-btn" data-district="æµ¦ä¸œæ–°åŒº">æµ¦ä¸œæ–°åŒº</button>
                    <button class="district-btn" data-district="é—µè¡ŒåŒº">é—µè¡ŒåŒº</button>
                    <button class="district-btn" data-district="å®å±±åŒº">å®å±±åŒº</button>
                    <button class="district-btn" data-district="å˜‰å®šåŒº">å˜‰å®šåŒº</button>
                    <button class="district-btn" data-district="é‡‘å±±åŒº">é‡‘å±±åŒº</button>
                    <button class="district-btn" data-district="æ¾æ±ŸåŒº">æ¾æ±ŸåŒº</button>
                    <button class="district-btn" data-district="é’æµ¦åŒº">é’æµ¦åŒº</button>
                    <button class="district-btn" data-district="å¥‰è´¤åŒº">å¥‰è´¤åŒº</button>
                    <button class="district-btn" data-district="å´‡æ˜åŒº">å´‡æ˜åŒº</button>
                </div>
                <div class="layers-control">
                    <div class="layer-toggle">
                        <input type="checkbox" id="schools" checked>
                        <label for="schools">æ˜¾ç¤ºå­¦æ ¡</label>
                    </div>
                    <div class="layer-toggle">
                        <input type="checkbox" id="communities" checked>
                        <label for="communities">æ˜¾ç¤ºå°åŒº</label>
                    </div>
                </div>
            </div>
        </div>
        <div class="map-container">
            <div id="map"></div>
            <div class="info-panel">
                <h3>å…´è¶£ç‚¹ä¿¡æ¯</h3>
                <ul class="poi-list" id="poiList"></ul>
            </div>
        </div>
    </div>
    
    <script>
        // ä¸Šæµ·å„åŒºä¸­å¿ƒç‚¹åæ ‡
        const shanghaiDistricts = {
            "é»„æµ¦åŒº": {center: [121.480541, 31.233567], zoom: 13},
            "å¾æ±‡åŒº": {center: [121.43701, 31.192064], zoom: 12},
            "é•¿å®åŒº": {center: [121.422814, 31.223644], zoom: 12},
            "é™å®‰åŒº": {center: [121.464907, 31.238854], zoom: 13},
            "æ™®é™€åŒº": {center: [121.426121, 31.234427], zoom: 12},
            "è™¹å£åŒº": {center: [121.484902, 31.271602], zoom: 13},
            "æ¨æµ¦åŒº": {center: [121.51975, 31.260337], zoom: 12},
            "æµ¦ä¸œæ–°åŒº": {center: [121.537176, 31.214604], zoom: 11},
            "é—µè¡ŒåŒº": {center: [121.387451, 31.115125], zoom: 11},
            "å®å±±åŒº": {center: [121.486918, 31.381493], zoom: 11},
            "å˜‰å®šåŒº": {center: [121.241307, 31.394916], zoom: 11},
            "é‡‘å±±åŒº": {center: [121.337055, 30.746298], zoom: 10},
            "æ¾æ±ŸåŒº": {center: [121.232855, 31.03284], zoom: 11},
            "é’æµ¦åŒº": {center: [121.154723, 31.158774], zoom: 11},
            "å¥‰è´¤åŒº": {center: [121.464428, 30.919492], zoom: 10},
            "å´‡æ˜åŒº": {center: [121.403693, 31.720192], zoom: 9}
        };
        
        // åœ°å›¾å®ä¾‹
        let map = null;
        // POIæ ‡è®°ç»„
        let schoolMarkers = [];
        let communityMarkers = [];
        // å½“å‰æ˜¾ç¤ºçš„å…´è¶£ç‚¹åˆ—è¡¨
        let currentPOIs = [];
        
        // åˆå§‹åŒ–åœ°å›¾
        function initMap() {
            // åˆå§‹åŒ–åœ°å›¾ï¼Œé»˜è®¤æ˜¾ç¤ºé»„æµ¦åŒº
            const defaultDistrict = "é»„æµ¦åŒº";
            const defaultConfig = shanghaiDistricts[defaultDistrict];
            
            map = new AMap.Map('map', {
                zoom: defaultConfig.zoom,
                center: defaultConfig.center,
                viewMode: '3D',
                pitch: 0
            });
            
            // æ·»åŠ åœ°å›¾æ§ä»¶
            map.addControl(new AMap.ToolBar());
            map.addControl(new AMap.Scale());
            map.addControl(new AMap.MapType());
            
            // åŠ è½½é»˜è®¤åŒºåŸŸçš„POI
            loadPOIs(defaultDistrict);
            
            // ç»‘å®šäº‹ä»¶
            bindEvents();
        }
        
        // ç»‘å®šäº‹ä»¶
        function bindEvents() {
            // åŒºåŸŸåˆ‡æ¢
            document.querySelectorAll('.district-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.district-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const district = this.dataset.district;
                    switchDistrict(district);
                });
            });
            
            // å›¾å±‚æ§åˆ¶
            document.getElementById('schools').addEventListener('change', function() {
                toggleSchools(this.checked);
            });
            
            document.getElementById('communities').addEventListener('change', function() {
                toggleCommunities(this.checked);
            });
        }
        
        // åˆ‡æ¢åŒºåŸŸ
        function switchDistrict(district) {
            const districtConfig = shanghaiDistricts[district];
            if (districtConfig) {
                // ç§»åŠ¨åœ°å›¾åˆ°æŒ‡å®šåŒºåŸŸ
                map.setCenter(districtConfig.center);
                map.setZoom(districtConfig.zoom);
                
                // æ¸…é™¤ç°æœ‰æ ‡è®°
                clearMarkers();
                
                // åŠ è½½æ–°åŒºåŸŸçš„POI
                loadPOIs(district);
            }
        }
        
        // åŠ è½½POIæ•°æ®
        function loadPOIs(district) {
            currentPOIs = [];
            
            // æ¨¡æ‹Ÿæ•°æ® - åœ¨å®é™…åº”ç”¨ä¸­ï¼Œè¿™é‡Œåº”è¯¥è°ƒç”¨APIè·å–çœŸå®æ•°æ®
            const mockSchools = [
                {name: `${district}ç¬¬ä¸€ä¸­å­¦`, type: 'school', location: [121.480541, 31.233567]},
                {name: `${district}ç¬¬äºŒå°å­¦`, type: 'school', location: [121.482541, 31.235567]},
                {name: `${district}å®éªŒå­¦æ ¡`, type: 'school', location: [121.478541, 31.231567]}
            ];
            
            const mockCommunities = [
                {name: `${district}èŠ±å›­å°åŒº`, type: 'community', location: [121.485541, 31.234567]},
                {name: `${district}æ–°æ‘`, type: 'community', location: [121.479541, 31.236567]},
                {name: `${district}å›½é™…ç¤¾åŒº`, type: 'community', location: [121.481541, 31.232567]}
            ];
            
            // åˆå¹¶æ‰€æœ‰POI
            currentPOIs = [...mockSchools, ...mockCommunities];
            
            // åœ¨åœ°å›¾ä¸Šæ·»åŠ æ ‡è®°
            addMarkers();
            
            // æ›´æ–°å…´è¶£ç‚¹åˆ—è¡¨
            updatePOIList();
        }
        
        // æ·»åŠ æ ‡è®°
        function addMarkers() {
            const showSchools = document.getElementById('schools').checked;
            const showCommunities = document.getElementById('communities').checked;
            
            currentPOIs.forEach(poi => {
                const marker = new AMap.Marker({
                    position: poi.location,
                    title: poi.name,
                    content: `<div style="background-color: ${poi.type === 'school' ? '#1890ff' : '#52c41a'}; color: white; padding: 4px 8px; border-radius: 4px; font-size: 12px;">${poi.type === 'school' ? 'ğŸ«' : 'ğŸ˜ï¸'} ${poi.name}</div>`,
                    offset: new AMap.Pixel(-50, -25)
                });
                
                // æ·»åŠ ç‚¹å‡»äº‹ä»¶
                marker.on('click', function() {
                    showPOIDetail(poi);
                });
                
                // æ ¹æ®ç±»å‹æ·»åŠ åˆ°å¯¹åº”çš„æ ‡è®°ç»„
                if (poi.type === 'school') {
                    schoolMarkers.push(marker);
                    if (showSchools) {
                        map.add(marker);
                    }
                } else if (poi.type === 'community') {
                    communityMarkers.push(marker);
                    if (showCommunities) {
                        map.add(marker);
                    }
                }
            });
        }
        
        // æ¸…é™¤æ‰€æœ‰æ ‡è®°
        function clearMarkers() {
            // æ¸…é™¤å­¦æ ¡æ ‡è®°
            if (schoolMarkers.length > 0) {
                map.remove(schoolMarkers);
                schoolMarkers = [];
            }
            
            // æ¸…é™¤å°åŒºæ ‡è®°
            if (communityMarkers.length > 0) {
                map.remove(communityMarkers);
                communityMarkers = [];
            }
        }
        
        // åˆ‡æ¢å­¦æ ¡æ˜¾ç¤º
        function toggleSchools(show) {
            if (show) {
                map.add(schoolMarkers);
            } else {
                map.remove(schoolMarkers);
            }
        }
        
        // åˆ‡æ¢å°åŒºæ˜¾ç¤º
        function toggleCommunities(show) {
            if (show) {
                map.add(communityMarkers);
            } else {
                map.remove(communityMarkers);
            }
        }
        
        // æ›´æ–°å…´è¶£ç‚¹åˆ—è¡¨
        function updatePOIList() {
            const poiList = document.getElementById('poiList');
            poiList.innerHTML = '';
            
            currentPOIs.forEach(poi => {
                const li = document.createElement('li');
                li.className = 'poi-item';
                li.innerHTML = `<strong>${poi.type === 'school' ? 'ğŸ«' : 'ğŸ˜ï¸'} ${poi.name}</strong>`;
                li.addEventListener('click', function() {
                    // åœ°å›¾ä¸­å¿ƒå®šä½åˆ°è¯¥POI
                    map.setCenter(poi.location);
                    map.setZoom(15);
                    // æ˜¾ç¤ºPOIè¯¦æƒ…
                    showPOIDetail(poi);
                });
                poiList.appendChild(li);
            });
        }
        
        // æ˜¾ç¤ºPOIè¯¦æƒ…
        function showPOIDetail(poi) {
            // è¿™é‡Œå¯ä»¥æ˜¾ç¤ºæ›´è¯¦ç»†çš„POIä¿¡æ¯
            // ä¾‹å¦‚ï¼šå¼¹å‡ºä¿¡æ¯çª—å£
            const infoWindow = new AMap.InfoWindow({
                content: `<div style="padding: 10px;"><h4>${poi.name}</h4><p>ç±»å‹ï¼š${poi.type === 'school' ? 'å­¦æ ¡' : 'å°åŒº'}</p></div>`,
                offset: new AMap.Pixel(0, -30)
            });
            
            infoWindow.open(map, poi.location);
        }
        
        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–åœ°å›¾
        window.addEventListener('DOMContentLoaded', async function() {
            try {
                await loadAMapAPI();
                initMap();
            } catch (error) {
                console.error('Failed to load AMap API:', error);
                document.getElementById('map').innerHTML = '<div style="text-align: center; padding: 2rem; color: red;">åœ°å›¾åŠ è½½å¤±è´¥ï¼Œè¯·åˆ·æ–°é¡µé¢é‡è¯•</div>';
            }
        });
    </script>
</body>
</html>